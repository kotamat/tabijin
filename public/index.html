<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>タビジン</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
    html, body { height: 100%; margin: 0; padding: 0; }
    #map { height: 100%; }
    #shop_list{position: absolute; left:0px; top:50px; background: white; padding:10px;}
    </style>
    <script src="https://code.jquery.com/jquery-git2.min.js"> </script>
</head>
<body>
    <div id="map"></div>
    <div id="shop_list">
        <ul>
        </ul>
    </div>
    <script type="text/javascript">
    (function() {
        var setShops, initialize, infowindow;

        this.start_func = function() {
            var shops = [
                {
                    name: "すし半",
                    detail: "男性60代 10人",
                    lat: 35.364726,
                    lng: 136.617108
                },
                {
                    name: "芭蕉",
                    detail: "男性60代 11人",
                    lat: 35.364197,
                    lng: 136.61713
                },
            ];
            initialize();
            setShops(shops);
        };

        initialize = function() {
            var defLatlng = new google.maps.LatLng(35.363398, 136.617308);
            var mapOptions = {
                zoom: 17,
                center: defLatlng,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            this.map = new google.maps.Map(document.getElementById("map"), mapOptions)
        }

        setShops = function(shops) {
            var LatLng, _, marker, markerOptions, shop;
            for (_ in shops) {
                shop = shops[_];
                $('#shop_list ul').append('<li><b>' + shop.name + '</b><div>' + shop.detail + '</div></li>' );
                LatLng = new google.maps.LatLng(shop.lat, shop.lng);
                markerOptions = {
                    position: LatLng,
                    map: this.map,
                    title: "name is " + shop.name
                };
                marker = new google.maps.Marker(markerOptions);
                showInfoWindow(marker, shop);
            }
        };

        showInfoWindow = function(marker, shop) {
            google.maps.event.addListener(marker, "click", function() {
                if(infowindow) infowindow.close();
                infowindow = new google.maps.InfoWindow({
                    content: '<b>' + shop.name + '</b><div>' + shop.detail + '</div>'
                });
                return infowindow.open(this.map, marker);
            });
        }

    }).call(this);
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAHG3DVk3_kKGOaHOCkaMCZcIs4724aPg4&callback=start_func">
    </script>
</body>
</html>
